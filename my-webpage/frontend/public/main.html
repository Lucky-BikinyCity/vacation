<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메인</title>
    <link rel="stylesheet" href="../src/index.css">
</head>
<body id="mainBody" class="dragUnable">
    <header class="mainHtmlHeader">
        <img src="../imgs/web-icons/logo2-B.png" alt="Logo" class="logo logoInMain">
        <div class="profileWrapper">
            <div class="profileNameWrapper">
                <img src="../imgs/icon/user_circle.png" class="profileImg" alt="">
                <span id="profileName" class="profileName"></span>
            </div>
            <div class="profileInfo">
                <div class="containerInProfileInfo">
                    <img src="../imgs/icon/group-B.png" alt="">
                    <div>그룹</div>
                    <div></div> <!--그냥 더미-->
                    <span id="group_count" class="count"></span> <!--그룹 갯수-->
                </div>

                <div class="containerInProfileInfo">
                    <img src="../imgs/icon/heart_fill.png" alt="">
                    <div>좋아요</div>
                    <div></div> <!--그냥 더미-->
                    <span id="like_count" class="count"></span> <!--좋아요 갯수-->
                </div>

                <!--로그아웃 버튼-->
                <button id="logout" class="logoutInProfile">
                    <img src="../imgs/icon/exit-b.png" alt="">
                    로그아웃
                </button>
            </div>
        </div>
    </header>
    <main class="mainHtmlMain">
        <!--맨 아래그룹추가 버튼이 눌리면 아래 div가 보여지고 맨 아래 그룹추가버튼은 display none으로 가려버림-->
        <div id="groupBoxes" class="groupBoxes">

            <!--그룹 박스-->
            <a href="../public/group.html" id="groupBox" class="groupBox existGroup">
                <div class="imgWrapper">
                    <img id="thumbnail" class="thumbnail" src="" alt="" onerror="this.style.display='none'"> <!--썸네일 이미지 공간 onerror를 이용해서 이미지 주소가 없을 때 display none으로 아예 감춰버림-->
                    <img class="logo" src="../imgs/web-icons/logo1-B.png" alt="">
                </div>
                <div class="groupInfoContainer" onclick="location.href='../public/group.html';">
                    <div class="groupInfo">
                        <div id="group_name" class="namingGroup koreanFont">[그룹 이름]</div>
                        <div class="numberingMember">
                            <img src="../imgs/icon/group.png" alt="">
                            <span id="member_count" class="count">3</span>
                        </div>
                    </div>
                    <div class="buttonWrapper">
                        <button class="koreanFont" id="delGroup">
                            <img src="../imgs/icon/exit.png" alt="">
                        </button>
                    </div>
                </div>
            </a>

            <!--그룹 추가 박스-->
            <div id="createGroup" class="groupBox createGroup">
                <!--썸네일-->
                <div id="imgWrapper" class="imgWrapper">
                    <img class="logo" src="../imgs/web-icons/logo1-B.png" alt="">
                </div>
                <!--아래 세팅부분-->
                <div id="groupSetting" class="groupSetting">
                    <div class="groupInfo">
                        <!--그룹 이름-->
                        <div class="namingGroup">
                            <input id="input_group_name" type="text" placeholder="group name">
                        </div>
                        <!--멤버 수 설정-->
                        <div class="numberingMember">
                            <img src="../imgs/icon/group.png" alt="">
                            <span>member</span>
                            <div class="member-count-container">
                                <button class="minus" onclick="handleMemberCount(-1)">-</button>
                                <input type="input_member_number" id="member-count" value="2" min="2" />
                                <button class="plus" onclick="handleMemberCount(1)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="buttonWrapper">
                        <button class="koreanFont" id="add-button">추가</button>
                    </div>
                </div>
            </div>

            <!--boxes활성화 상태시 그룹 추가 버튼-->
            <button id="addGroupInBoxes" class="addGroupInGroupBox">
                <img src="../imgs/icon/add_circle.png" alt="Logo" class="addCircle">
                <div class="addGroupPhrase koreanFont">그룹 추가</div>
            </button>
        </div>

        <!--boxes 비활성화 상태시 그룹 추가 버튼-->
        <button id="addGroupOnMain" class="addGroup">
            <img src="../imgs/icon/add_circle.png" alt="Logo" class="addCircle">
            <div class="addGroupPhrase koreanFont">그룹 추가</div>
        </button>
    </main>
    <script src="../src/index.js"></script>
</body>
<script src="../src/index.js"></script>
<script>
    // 페이지 로드 시 사용자 정보 가져오기
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            const response = await fetch('/api/main');
            if (!response.ok) {
                throw new Error('사용자 정보를 가져오지 못했습니다.');
            }
            const data = await response.json();
            document.getElementById('profileName').textContent = data.user_name;
            document.getElementById('group_count').textContent = data.group_count;
            document.getElementById('like_count').textContent = data.like_count;
        } catch (error) {
            console.error('Error:', error);
            // 세션이 없을 경우 로그인 페이지로 리디렉션
            window.location.href = '/';
        }
    });

    // 로그아웃 버튼 클릭 시 로그아웃 처리
    document.getElementById('logout').addEventListener('click', async function() {
        try {
            const response = await fetch('/logout');
            if (!response.ok) {
                throw new Error('로그아웃에 실패했습니다.');
            }
            const result = await response.json();
            if (result.success) {
                window.location.href = '/';
            } else {
                throw new Error('로그아웃에 실패했습니다.');
            }
        } catch (error) {
            console.error('Error:', error);
        }
    });
</script>
</html>